parameters:
  pool: {}
jobs:
- job: Publish_Finalize
  condition: succeeded('Copy_Images')
  dependsOn:
  - Copy_Images
  pool: ${{ parameters.pool }}
  variables:
    imageBuilder.commonCmdArgs: >
      --manifest $(manifest)
      --registry-override $(acr.server)
      --repo-prefix $(publishRepoPrefix)
      $(imageBuilder.queueArgs)
  steps:
  - template: ../steps/init-docker-linux.yml
  - script: >
      $(runImageBuilderCmd) publishManifest
      $(imageBuilder.commonCmdArgs)
      --username $(acr.userName)
      --password $(BotAccount-dotnet-docker-acr-bot-password)
    displayName: Publish Manifest
  # TODO:  Blocked on bot account
  # - script: >
  #     $(runImageBuilderCmd) publishMcrReadmes
  #     $(imageBuilder.commonCmdArgs)
  #     $(dotnetBuildBot-userName)
  #     $(dotnetBuildBot-email)
  #     $(AccessToken-dotnet-build-bot-public-repo)
  #   displayName: Publish Readme
  - template: ../steps/cleanup-docker-linux.yml
